import*as UI from"../ui/ui.js";import*as Common from"../common/common.js";import*as SDK from"../sdk/sdk.js";import*as JSONEditor from"../features/JSONEditor.js";export class ComponentDataWidget extends UI.ThrottledWidget.ThrottledWidget{constructor(){super(!0),this._emptyElement=this.contentElement.createChild("div","gray-info-message"),this._emptyElement.textContent=Common.UIString.UIString("No component data"),UI.Context.Context.instance().addFlavorChangeListener(SDK.DOMModel.DOMNode,this._update,this),this._update(),Wxml.wxmlMessenger.on("COMPONENT_DATA",t=>{const{componentData:e,exparseNodeId:n}=t;this._exparseNodeId=n,this._render(e)})}async _update(){const t=UI.Context.Context.instance().flavor(SDK.DOMModel.DOMNode);t?await Wxml.target.domAgent().getComponentData(t.id):this._render(null)}async _render(t){let e=this._jsonEditor;if(e||(e=JSONEditor.jsonEditorFactory.createEditor({onChange:()=>{const t=e.getJSONEditor().get();Wxml.wxmlMessenger.send("WXML_MODIFY_COMPONENT_DATA",{componentData:t,id:this._exparseNodeId,webviewId:Wxml.remoteMessenger.getDebuggee().targetId})}}),e.contentElement.addEventListener("focus",()=>{this._isEditing=!0},!0),e.contentElement.addEventListener("blur",()=>{this._isEditing=!1},!0),this._jsonEditor=e),!t)return e.detach(),e.getJSONEditor().set({}),void this._emptyElement.classList.remove("hidden");this._emptyElement.classList.add("hidden"),this._isEditing||e.getJSONEditor().update(t),e.show(this.contentElement)}}